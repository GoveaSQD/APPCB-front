<div class="dashboard-container p-4">
  <!-- Header con bienvenida -->
  <div class="flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="text-3xl font-bold text-900 mb-1">
        ¡Bienvenido, {{ usuario?.nombre || 'Usuario' }}!
      </h1>
      <p class="text-600 m-0">
        {{ dateToday | date:'EEEE, d MMMM yyyy' }}
      </p>
    </div>
    <div class="flex gap-2">
      <p-button 
        label="Actualizar" 
        icon="pi pi-refresh" 
        (onClick)="refreshDashboard()"
        [loading]="stats.loading"
        styleClass="p-button-outlined">
      </p-button>
    </div>
  </div>

  <p-toast position="top-right"></p-toast>

  <!-- Cards de estadísticas -->
  <div class="grid">
    <!-- Becados -->
    <div class="col-12 md:col-6 lg:col-3">
      <p-card class="stats-card">
        <ng-template pTemplate="content">
          <div class="flex align-items-center">
            <div class="stats-icon bg-blue-100">
              <i class="pi pi-users text-2xl text-blue-600"></i>
            </div>
            <div class="ml-3">
              <span class="stats-label">Total Becados</span>
              @if (stats.loading) {
                <p-skeleton width="80px" height="36px"></p-skeleton>
              } @else {
                <div class="stats-value">{{ stats.totalBecados }}</div>
              }
            </div>
          </div>
          @if (!stats.loading) {
            <div class="mt-3">
              <div class="flex justify-content-between mb-1">
                <span class="text-sm">Activos</span>
                <span class="text-sm font-bold">{{ stats.becadosActivos }} / {{ stats.totalBecados }}</span>
              </div>
              <p-progressBar 
                [value]="getBecadosActivosPorcentaje()" 
                [showValue]="false"
                styleClass="h-2">
              </p-progressBar>
            </div>
          }
        </ng-template>
      </p-card>
    </div>

    <!-- Universidades -->
    <div class="col-12 md:col-6 lg:col-3">
      <p-card class="stats-card">
        <ng-template pTemplate="content">
          <div class="flex align-items-center">
            <div class="stats-icon bg-green-100">
              <i class="pi pi-building text-2xl text-green-600"></i>
            </div>
            <div class="ml-3">
              <span class="stats-label">Universidades</span>
              @if (stats.loading) {
                <p-skeleton width="80px" height="36px"></p-skeleton>
              } @else {
                <div class="stats-value">{{ stats.totalUniversidades }}</div>
              }
            </div>
          </div>
          @if (!stats.loading && stats.universidadesPorPais.length > 0) {
            <div class="mt-2 text-sm text-600">
              <i class="pi pi-map-marker mr-1"></i>
              {{ stats.universidadesPorPais.length }} países diferentes
            </div>
          }
        </ng-template>
      </p-card>
    </div>

    <!-- Modalidades -->
    <div class="col-12 md:col-6 lg:col-3">
      <p-card class="stats-card">
        <ng-template pTemplate="content">
          <div class="flex align-items-center">
            <div class="stats-icon bg-purple-100">
              <i class="pi pi-tags text-2xl text-purple-600"></i>
            </div>
            <div class="ml-3">
              <span class="stats-label">Modalidades</span>
              @if (stats.loading) {
                <p-skeleton width="80px" height="36px"></p-skeleton>
              } @else {
                <div class="stats-value">{{ stats.totalModalidades }}</div>
              }
            </div>
          </div>
        </ng-template>
      </p-card>
    </div>

    <!-- Usuarios -->
    <div class="col-12 md:col-6 lg:col-3">
      <p-card class="stats-card">
        <ng-template pTemplate="content">
          <div class="flex align-items-center">
            <div class="stats-icon bg-orange-100">
              <i class="pi pi-user text-2xl text-orange-600"></i>
            </div>
            <div class="ml-3">
              <span class="stats-label">Usuarios</span>
              @if (stats.loading) {
                <p-skeleton width="80px" height="36px"></p-skeleton>
              } @else {
                <div class="stats-value">{{ stats.totalUsuarios }}</div>
              }
            </div>
          </div>
        </ng-template>
      </p-card>
    </div>
  </div>

  <!-- Gráfica y tabla -->
  <div class="grid mt-4">
    <!-- Gráfica de universidades -->
    <div class="col-12 lg:col-6">
      <p-card header="Universidades por País" subheader="Distribución geográfica">
        <ng-template pTemplate="content">
          @if (stats.loading) {
            <div class="flex justify-content-center p-5">
              <i class="pi pi-spin pi-spinner text-4xl text-primary"></i>
            </div>
          } @else if (stats.universidadesPorPais.length > 0) {
            <div style="height: 300px;">
              <p-chart 
                type="bar" 
                [data]="chartData" 
                [options]="chartOptions">
              </p-chart>
            </div>
          } @else {
            <div class="text-center p-5 text-gray-500">
              <i class="pi pi-chart-bar text-5xl mb-3"></i>
              <p>No hay datos de universidades para mostrar</p>
            </div>
          }
        </ng-template>
      </p-card>
    </div>

    <!-- Últimos becados -->
    <div class="col-12 lg:col-6">
      <p-card header="Últimos Becados" subheader="Registros recientes">
        <ng-template pTemplate="content">
          @if (stats.loading) {
            <div class="flex flex-column gap-2">
              <p-skeleton height="50px"></p-skeleton>
              <p-skeleton height="50px"></p-skeleton>
              <p-skeleton height="50px"></p-skeleton>
            </div>
          } @else if (stats.ultimosBecados.length > 0) {
            <div class="flex flex-column gap-2">
              @for (becado of stats.ultimosBecados; track becado.id) {
                <div class="flex align-items-center justify-content-between p-2 border-1 surface-border border-round hover:surface-hover cursor-pointer">
                  <div class="flex align-items-center gap-2">
                    <p-avatar 
                      [label]="becado.nombre?.charAt(0) + becado.apellido?.charAt(0)" 
                      shape="circle"
                      styleClass="bg-primary text-white">
                    </p-avatar>
                    <div>
                      <div class="font-medium">{{ becado.nombre }} {{ becado.apellido }}</div>
                      <div class="text-sm text-600">{{ becado.universidad }}</div>
                    </div>
                  </div>
                  <p-tag 
                    [severity]="getSeverity(becado.activo)"
                    [value]="becado.activo ? 'Activo' : 'Inactivo'">
                  </p-tag>
                </div>
              }
            </div>
            
            <div class="mt-3 text-right">
              <button 
                pButton 
                pRipple 
                label="Ver todos" 
                icon="pi pi-arrow-right"
                class="p-button-text"
                routerLink="/becados">
              </button>
            </div>
          } @else {
            <div class="text-center p-5 text-gray-500">
              <i class="pi pi-users text-5xl mb-3"></i>
              <p>No hay becados registrados</p>
              <p-button 
                label="Agregar becado" 
                icon="pi pi-plus"
                styleClass="p-button-outlined mt-2"
                routerLink="/becados/nuevo">
              </p-button>
            </div>
          }
        </ng-template>
      </p-card>
    </div>
  </div>

  <!-- Accesos rápidos -->
  <div class="grid mt-4">
    <div class="col-12">
      <p-card header="Accesos Rápidos">
        <ng-template pTemplate="content">
          <div class="grid">
            <div class="col-12 md:col-3">
              <button 
                pButton 
                pRipple 
                label="Nuevo Becado" 
                icon="pi pi-user-plus"
                class="p-button-success w-full"
                routerLink="/becados/nuevo">
              </button>
            </div>
            <div class="col-12 md:col-3">
              <button 
                pButton 
                pRipple 
                label="Nueva Universidad" 
                icon="pi pi-building"
                class="p-button-info w-full"
                routerLink="/universidades/nuevo">
              </button>
            </div>
            <div class="col-12 md:col-3">
              <button 
                pButton 
                pRipple 
                label="Nueva Modalidad" 
                icon="pi pi-tag"
                class="p-button-warning w-full"
                routerLink="/modalidades/nuevo">
              </button>
            </div>
            <div class="col-12 md:col-3">
              <button 
                pButton 
                pRipple 
                label="Ver Reportes" 
                icon="pi pi-chart-bar"
                class="p-button-secondary w-full">
              </button>
            </div>
          </div>
        </ng-template>
      </p-card>
    </div>
  </div>
</div>